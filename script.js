// script.js

const postsContainer = document.getElementById('postsContainer');
const imagePreview = document.getElementById('imagePreview');
const selectedTags = document.getElementById('selectedTags');
const tagSelect = document.getElementById('tagSelect');

// 예시 게시글 데이터
const posts = [
    { title: '안내글', content: '단편소설: 차원 검문소

마르코 앨리예프. 스물 넷의 청년
그는 전쟁 영웅 이었다. 그의 조국이 침략 전쟁을 벌이게 되었을 때 적군을 닥치는 대로 죽였다. 가리지 않고 모두를 죽였다. 그 당시 그에게는 서로 뗄 수 없는 친구가 있었는데 그 친구가 적국의 군에 입대하고 둘은 전장에서 서로 만났다. 그리고 앨리예프는 당연한듯 그를 총으로 쏴 죽였다. 그때의 앨리예프는 자신의 행동이 옳은 것이라고만 생각했다. 그러나 앨리예프의 문제는 전쟁이 끝난 뒤 부터 시작되었다. 점차 그의 조국이 벌였던 침략 전쟁이 잘못된 짓이었단 것을 자신의 벌였던 행동을 통해 점차 깨닫고, 결국 모든것을 깨달았을 때에 전쟁에 관한 트라우마와 지병이었던, 다 치료 된 줄로만 알았던 조현병 증세가 다시 나타났다.
앨리예프는 매일 밤을 눈물로 지세울 수 밖에 없었다. 눈물로 지세우지라도 않는다면 그는 미쳐버렸을 것이다.
그는 그날도 어김없이 다른 날처럼 눈물로 밤을 지세우려 하였다. 하지만 그날 따라 잠이 잘 왔고 결국 자신의 집 소파에서 잠이 들었다.
.... 앨리예프가 잠에서 깨어났다. 깨어난 곳은 처음 맡아보는 향기로운 향기가 나는 잿빛 연기로 뒤덮여 있었고 어떤 색인지 표현하기 어려운 색의 언덕이 있었다. 마치 텔레비전의 노이즈 같았다. 수많은 점들과 - 알수없는 색들로 이루어진 언덕이었다.
앨리예프는 그곳이 꿈인지, 현실인지, 아니면 자신이 죽인 수많은 생명들로 인해 흔히 말하는 '지옥'에 온것인지 헷갈렸다. 사실 그곳을 정확히 아는 것이 더욱 이상한 것이니 그다지 할 말은 없었다.
앨리예프는 이상한 장소를 걷고 걸었다. 하지만 아무리 걷고, 또 걸어도 이상한 색의 잔디밭과 잿빛 연기만이 그를 반겨주었다
.. 10분 즈음 지났을까 앨리예프는 작은 초소 하나를 발견한다.
직사각형으로 만들어진 철제 초소에는 입구가 있었다. 초소 좌측과 우측엔 거대한 장벽만이 있었다. 이상한 광경이었지만 뭐 어쩌겠는가. 당연히 할 수 있는건 입구로 들어가는 것 뿐이다.
앨리예프는 초소 입구로 들어갔다. 초소의 입구는 작은 상하 계폐식 나무 문으로 이루어져 있었는데 나무의 향기가 참 독특하였다.
초소 문을 조용히 열었다. 작은 공간이 있었다.
온화한 분위기였다. 내부는 목제로 이루어져 있었다. 천장에는 조명이 몇개 달려있었는데 현대식 조명은 아니고 각등(램프)에 가까웠다.
.. 들어와서 내부를 구경하던 중에 앨리예프가 무언가를 발견하였다.
셔터였다. 철제 셔터였는데 초소를 절반씩 나눠 가로막고 있었다 그저 셔터이지만 앨리예프는 그것을 아름답다 느꼈다.
.. 갑작스레 셔터가 열렸다. 셔터가 열리자 그동안 안보였던 절반이 보였는데 그 절반은 안내소처럼 보이는 무언가 였다. 안내소에는 작은 구멍이 있었다. 아마도 무언갈 전해받거나 건네받기 위한 구멍 같았다. 안내소는 통 유리로 되있고 말을 하기 위한 구멍또한 나있었다.
안내소 내부는 의자가 있었다 꽤 큰 책상이 있었다. 재떨이와 수첩. 펜 등이 놓여있었고 서랍도 보였고 라디오와 타자기등도 있었다.
.. 앨리예프가 잠시 안내소에서 눈을 떼고 다시 안내소 방향을 보았을 땐  갑작스레 한 남자가 안내소 내부의 의자에 앉아있었다.
남자의 귀에는 담배가 꽂혀 있었다. 머리는 산발머리라고 밖에 표현 할 수 없었다 머리가 썩 길었다. 남자는 젊어보였다.
"서류 제출하십시오." 남자가 입을 뗐다.
"뭐라는 겁니까? 여긴 어디예요?" 앨리예프가 신경질적으로 물었다.
남자는 담배를 빼어 책상 위에 두며, 미소를 지었다. "여긴... 그동안 당신이 잊고 있던 장소일 수도 있고, 혹은 처음인 곳일 수도 있죠."
"그게 무슨 말이오?" 앨리예프가 답답한 듯 물었다.
"사람마다 각자의 길이 있지 않습니까. 당신은 여러 갈림길을 지나왔고, 지금 이곳은 그 중 하나의 끝이자 시작일지도 모르겠네요."
앨리예프가 남자를 노려보며 말했다. "무슨 소릴 하는 거요. 이건 꿈이겠지. 이렇게 황당한 얘기를 듣고 있다는 것부터가."
남자는 고개를 좌우로 흔들며 작은 웃음을 흘렸다. "꿈인가요? 아니면 현실인가요? 그 판단은 당신이 해야겠죠. 하지만 한 가지는 확실합니다." 그가 그의 귀에 꽂혀있던 담배를 손에 들고는 재떨이에 담배를 비벼가며 말을 이었다. "당신이 잊고 있던 무언가가 여기에서 다시 시작된다는 것."
앨리예프는 말문이 막혀 잠시 침묵했다. 
"자 너무 제 말만 했군요. 아무 말이나 해보시겠어요? 꼭 말을 하셔야 해요. 그게 규정이라서 말입니다." 남자가 코웃음을 치며 말했다.
"자..잠깐 이게 내 꿈이라 해도, 이런식의 꿈은 꾼 적 없어" 앨리예프가 이것이 꿈인지 아닌지 확인하기 위해 자신의 볼을 스스로 꼬집으며 말했다.
"자 정확한 설명을 드릴까요?" 남자가 이번엔 진지한 투로 말했다.
".. 좋아요"
"사람은 여러개의 차원을 가집니다."
"그래서요?"
"차원마다 당신이 존재한단건 같지만 당신의 운명은 모두 다릅니다, 이 차원에서는 당신이 당신 친구를 죽였자만 다른 차원에선 전쟁에 참전하지도 않고 친구를 죽이지도 않았단 말입니다." 남자가 비아냥 대며 말했다.
"자.. 잠깐 내가 친구를 죽인건 어떻게 아는거고 내가 전쟁에 참전한 것도 어떻게 아는겁니까?" 앨리예프가 쓰러질 듯 한 공포심에 질린 목소리로 물었다. 사실 묻는게 아닐지도 모른다.
"당신은 마흔 하고도 여덟개 정도의 차원을 가지고 있습니다. 그 말은 당신은 48개의 운명을 가지고 있단 겁니다." 남자가 쏘아 붙이듯 말했다.
"좋습니다. 당신은 어느 차원으로 가시겠습니까?" 남자가 이번엔 부드럽고 진정된 투로 말했다.
몇 초 간의 침묵이 흘렀고, 앨리예프가 입을 뗐다.
"내가 평생 행복한 차원입니다."
"그러면 서류를 주시죠" 남자가 말했다.
"그런건 없습니다."
"당신 호주머니를 뒤져봐요, 앨리예프."
앨리예프는 몇초간 자신의 호주머니를 뒤졌고 구겨진 종이를 발견했다. 그리곤 그것이 '서류'라 직감하고 검문소에 뚫린 구멍으로 
종이를 펴서 남자에게 주었다.
"저의 소개가 좀 늦었군요. 차원 검문관 '아를로'라 합니다."
"늦었지만, 반가워요 아를로." 앨리예프가 꽤나 기쁜듯 말했다.
아를로는 서류를 유심히 보더니 서랍을 뒤지고 도장 하나를 찾아 꺼냈다. 
서류에 그 도장을 찍었다. 그리고 아를로가 말했다 "잘가십시오. 전쟁 영웅이시여."
그 말을 듣자마자 앨리예프는 잠에서 깨어났다. 얼마나 푹 잤는지 소파는 그가 자면서 흘린 침으로 범벅이 되어 있었다.
그 순간, 수화기 소리가 들렸다. 앨리예프는 소파에서 일어나 수화기를 받아들었다
"어 앨리예프 나야." 앨리예프가 죽인 친구의 목소리였다. 끝

이름: 마르코 앨리예프
성별: 남
본 차원: 제 3 차원
이송 차원: 제 8 차원

위 사실을 제국력 73년 3월 45일을 기해서 인정함.
차원 검문소장
', tags: ['태그1'] },
    { title: '안내2', content: '이미지 첨부 기능은 테스트 기능입니다. 작동 여부가 확실치 못합니다', tags: ['태그2'] }
];

// 게시글을 화면에 표시하는 함수
function displayPosts(posts) {
    postsContainer.innerHTML = '';
    posts.forEach(post => {
        const postElement = document.createElement('div');
        postElement.classList.add('post');
        postElement.innerHTML = `
            <h2>${post.title}</h2>
            <div class="tags">${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>
            <p>${post.content}</p>
        `;
        postsContainer.appendChild(postElement);
    });
}

// 검색 기능 구현
function searchPosts() {
    const query = document.getElementById('searchInput').value.toLowerCase();
    const filteredPosts = posts.filter(post =>
        post.title.toLowerCase().includes(query) ||
        post.tags.some(tag => tag.toLowerCase().includes(query))
    );
    displayPosts(filteredPosts);
}

// 이미지 미리보기 및 삭제 기능
function previewImages() {
    imagePreview.innerHTML = '';
    const files = document.getElementById('files').files;

    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();

        reader.onload = function(event) {
            const imageItem = document.createElement('div');
            imageItem.classList.add('image-item');

            const img = document.createElement('img');
            img.src = event.target.result;

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '삭제';
            deleteButton.onclick = function() {
                const newFiles = Array.from(files).filter((_, index) => index !== i);
                const dataTransfer = new DataTransfer();
                newFiles.forEach(file => dataTransfer.items.add(file));
                document.getElementById('files').files = dataTransfer.files;
                previewImages(); // 업데이트된 이미지 미리보기
            };

            imageItem.appendChild(img);
            imageItem.appendChild(deleteButton);
            imagePreview.appendChild(imageItem);
        };

        reader.readAsDataURL(file);
    }
}

// 태그 추가 및 삭제 기능
function addTag() {
    const tag = tagSelect.value;
    if (tag && !Array.from(selectedTags.children).some(child => child.textContent === tag)) {
        const tagItem = document.createElement('span');
        tagItem.textContent = tag;
        tagItem.classList.add('tag');
        tagItem.onclick = function() {
            selectedTags.removeChild(tagItem);
        };
        selectedTags.appendChild(tagItem);
        tagSelect.value = ''; // 선택한 태그 초기화
    }
}

// 초기 게시글 표시
displayPosts(posts);
